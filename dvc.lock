schema: '2.0'
stages:
  split_data:
    cmd: python src/data/stratification.py --config data/data_config.yaml 
      --annotation-path data/annotations/annotations-coco-1.0.json --output-dir 
      data/interim
    deps:
    - path: data/annotations/annotations-coco-1.0.json
      hash: md5
      md5: 1f33a4b946d011e3d2375268f8c4b5bd
      size: 384509
    - path: src/data/augmentation.py
      hash: md5
      md5: 1c94e035609aed63b225e610aeb04628
      size: 10340
    - path: src/data/stratification.py
      hash: md5
      md5: 9c5427ddce244b84a41a014450561dd6
      size: 23588
    params:
      data/data_config.yaml:
        augmentation.motion_blur:
          blur_limit: 3
          p: 0.3
        augmentation.prefix: aug_
        augmentation.random_brightness_contrast:
          brightness_limit: 0.1
          contrast_limit: 0.1
          p: 0.5
        augmentation.shift_scale_rotate:
          shift_limit: 0.05
          scale_limit: 0.1
          rotate_limit: 5
          p: 0.7
        augmentation.strategies:
        - shift_scale_rotate
        - random_brightness_contrast
        - motion_blur
        split.min_instances: 2
        split.seed: 42
        split.test_ratio: 0.15
        split.train_ratio: 0.7
        split.val_ratio: 0.15
        stratification.r_env:
        - bad_light
        - occluded
        - not_clean
        stratification.r_geo:
        - frontal
        - blurry
    outs:
    - path: data/interim/augmented_images
      hash: md5
      md5: 9670da41beb36c9be6e7e68460be6c85.dir
      size: 853410
      nfiles: 2
    - path: data/interim/test_master.json
      hash: md5
      md5: 1b3bebd09f02247b906eebe5ec28c7f2
      size: 111222
    - path: data/interim/train_master.json
      hash: md5
      md5: 8f3693b8f6dadd62ec2652ee465c2ff7
      size: 501485
    - path: data/interim/val_master.json
      hash: md5
      md5: 2229a1f562f7a437fab112ed3151a5c2
      size: 108193
  convert_detection:
    cmd: python src/data/coco_to_yolo.py --task detection --input data/interim 
      --output data/processed/detection --category-id 1 --category-name 
      container_door --config data/data_config.yaml
    deps:
    - path: data/interim/test_master.json
      hash: md5
      md5: 1b3bebd09f02247b906eebe5ec28c7f2
      size: 111222
    - path: data/interim/train_master.json
      hash: md5
      md5: 8f3693b8f6dadd62ec2652ee465c2ff7
      size: 501485
    - path: data/interim/val_master.json
      hash: md5
      md5: 2229a1f562f7a437fab112ed3151a5c2
      size: 108193
    - path: src/data/coco_to_yolo.py
      hash: md5
      md5: 83f5090daa8567be449cab35098ee587
      size: 15910
    params:
      data/data_config.yaml:
        detection.category_id: 1
        detection.category_name: container_door
    outs:
    - path: data/processed/detection
      hash: md5
      md5: 28b1b5d09bdb8d3ea0df0cd72c72565d.dir
      size: 202779575
      nfiles: 1005
  convert_localization:
    cmd: python scripts/data_processing/prepare_module_3_data.py --input 
      data/interim --output data/processed/localization --images-dir data/raw 
      --config data/data_config.yaml
    deps:
    - path: data/interim/test_master.json
      hash: md5
      md5: 1b3bebd09f02247b906eebe5ec28c7f2
      size: 111222
    - path: data/interim/train_master.json
      hash: md5
      md5: 8f3693b8f6dadd62ec2652ee465c2ff7
      size: 501485
    - path: data/interim/val_master.json
      hash: md5
      md5: 2229a1f562f7a437fab112ed3151a5c2
      size: 108193
    - path: data/raw
      hash: md5
      md5: 7642035df874b66d2609a23b81e2813f.dir
      size: 189475922
      nfiles: 831
    - path: scripts/data_processing/prepare_module_3_data.py
      hash: md5
      md5: a6592aa3b1be4f2bbe6ba84e8f627e71
      size: 20964
    params:
      data/data_config.yaml:
        localization.cont_door_category_id: 1
        localization.cont_door_category_name: container_door
        localization.cont_id_category_id: 2
        localization.cont_id_category_name: container_id
        localization.min_crop_size: 32
        localization.num_keypoints: 4
        localization.padding_ratio: 0.1
    outs:
    - path: data/processed/localization
      hash: md5
      md5: 64ebb01df34af6ce30eb820624e7ed91.dir
      size: 95699038
      nfiles: 979
