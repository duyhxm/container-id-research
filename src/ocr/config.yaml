# OCR Module Configuration

# ============================================================================
# ENGINE CONFIGURATION
# ============================================================================
engine:
  # OCR engine type: "tesseract", "rapidocr", or "hybrid"
  # - tesseract: Fast, best for single-line (30x faster)
  # - rapidocr: Robust, best for multi-line/low-contrast
  # - hybrid: Automatic selection based on layout + fallback
  type: "hybrid"
  
  # Enable angle classification (corrects rotated text)
  use_angle_cls: true
  
  # Use GPU acceleration if available
  use_gpu: true
  
  # Minimum text detection confidence score (0.0-1.0)
  # Lower threshold (0.3) for better text detection on challenging images
  text_score: 0.2
  
  # Language code for OCR model
  lang: "en"
  
  # Detection box threshold (0.0-1.0)
  # Lower = more sensitive, detects smaller/fainter text
  det_db_box_thresh: 0.5
  
  # Detection threshold (0.0-1.0)
  # Lower = more sensitive detection
  det_db_thresh: 0.3
  
  # Maximum side length for detection image
  # Larger = can detect smaller text but slower
  det_limit_side_len: 960

# ============================================================================
# HYBRID ENGINE CONFIGURATION (when type=\"hybrid\")
# ============================================================================
hybrid:
  # Enable automatic fallback to secondary engine
  enable_fallback: true
  
  # Minimum confidence threshold to accept result (0.0-1.0)
  # If primary engine confidence < this, try fallback
  fallback_confidence_threshold: 0.3

# ============================================================================
# THRESHOLD CONFIGURATION
# ============================================================================
thresholds:
  # Minimum OCR confidence to accept result (0.0-1.0)
  # Set to 0.0 for Tesseract (PSM 7 returns 0 confidence)
  min_confidence: 0.0
  
  # Minimum validation confidence after all checks (0.0-1.0)
  min_validation_confidence: 0.7
  
  # Aspect ratio threshold for layout detection
  # Values > this are considered single-line, <= are multi-line
  layout_aspect_ratio: 5.0

# ============================================================================
# LAYOUT DETECTION CONFIGURATION
# ============================================================================
layout:
  # Single-line layout aspect ratio range
  single_line_aspect_ratio_min: 5.0
  single_line_aspect_ratio_max: 9.0
  
  # Multi-line layout aspect ratio range
  multi_line_aspect_ratio_min: 2.5
  multi_line_aspect_ratio_max: 4.5

# ============================================================================
# CHARACTER CORRECTION CONFIGURATION
# ============================================================================
correction:
  # Enable domain-aware character correction
  enabled: true
  
  # Correction rules (position-dependent)
  rules:
    # Owner code corrections (positions 1-4: letters only)
    # Maps commonly confused digits to letters
    owner_code:
      "0": "O"  # Zero to letter O
      "1": "I"  # One to letter I
      "5": "S"  # Five to letter S
      "8": "B"  # Eight to letter B
    
    # Serial number corrections (positions 5-11: digits only)
    # Maps commonly confused letters to digits
    serial:
      "O": "0"  # Letter O to zero
      "I": "1"  # Letter I to one
      "S": "5"  # Letter S to five
      "B": "8"  # Letter B to eight

# ============================================================================
# CHECK DIGIT VALIDATION CONFIGURATION
# ============================================================================
check_digit:
  # Enable ISO 6346 check digit validation
  enabled: true
  
  # Attempt to correct check digit errors
  attempt_correction: true
  
  # Maximum number of character substitutions to try for correction
  max_correction_attempts: 10

# ============================================================================
# PREPROCESSING CONFIGURATION
# ============================================================================
preprocessing:
  # Minimum height for OCR (resize smaller images to this height)
  # RapidOCR performs better with larger text (>= 32px character height)
  # Tesseract works well with original size, so disable for tesseract
  min_height: 96
  
  # Enable automatic resize for small images
  # Disable for Tesseract (works better with original size)
  auto_resize: false
  
  # Interpolation method for upscaling: "linear" or "cubic"
  # linear: Faster, good quality for text
  # cubic: Slower, slightly better quality
  upscale_interpolation: "linear"
  
  # Enable CLAHE (Contrast Limited Adaptive Histogram Equalization)
  # Improves contrast for low-quality images
  enable_clahe: false
  clahe_clip_limit: 2.0
  clahe_tile_size: 8
  
  # Enable adaptive thresholding (binarization)
  # Converts grayscale to pure black/white
  enable_threshold: false
  threshold_block_size: 11
  threshold_c: 2

# ============================================================================
# OUTPUT CONFIGURATION
# ============================================================================
output:
  # Include raw OCR text in result
  include_raw_text: true
  
  # Include bounding box coordinates in result
  include_bounding_boxes: true
  
  # Include per-character confidence scores in result
  include_character_confidences: true
